import os
import json
import sys

def extract_files_created(report_path):
    total_files_created = 0
    files_created = []
    try:
        with open(report_path, 'r') as report_file:
            report_data = json.load(report_file)
            target_filename = report_data["target"]["file"]["name"]
            behavior = report_data.get('behavior', {})
            generic = behavior.get('generic', [])
            if len(generic) > 1:
                second_summary = generic[1].get('summary', {})
                files_created = second_summary.get('file_created', [])
                total_files_created = len(files_created)
            else:
                print(f"No second summary found in {report_path}")
    except Exception as e:
        print(f"Error processing {report_path}: {e}")
    return total_files_created, files_created, target_filename

def traverse_directory(directory_path):
    total_files_created_overall = 0
    for root, dirs, files in os.walk(directory_path):
        for file in files:
            if file == 'report.json':
                report_path = os.path.join(root, file)
                total_files_created, files_created, target_filename = extract_files_created(report_path)
                if files_created:
                    total_files_created_overall += total_files_created
                    print(f"Files created by {target_filename} at {report_path}:")
                    for file_name in files_created:
                        print(file_name)
                else:
                    print(f"No files created by {target_filename} at {report_path}")
    print(f"\nTotal number of files created: {total_files_created_overall}")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python script.py <directory_path>")
        sys.exit(1)
    
    directory_path = sys.argv[1]
    traverse_directory(directory_path)
