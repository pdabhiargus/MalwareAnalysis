import os
import json
import sys

def extract_directory_created(report_path):
    total_directory_created = 0
    directory_created = []
    try:
        with open(report_path, 'r') as report_file:
            report_data = json.load(report_file)
            target_filename = report_data["target"]["file"]["name"]
            behavior = report_data.get('behavior', {})
            summary = behavior.get('summary', {})
            directory_created = summary.get('directory_created', [])
            total_directory_created = len(directory_created)
    except Exception as e:
        print(f"Error processing {report_path}: {e}")
    return total_directory_created, directory_created, target_filename

def traverse_directory(directory_path):
    total_directory_created_overall = 0
    for root, dirs, directory in os.walk(directory_path):
        for file in directory:
            if file == 'report.json':
                report_path = os.path.join(root, file)
                total_directory_created, directory_created, target_filename = extract_directory_created(report_path)
                if directory_created:
                    total_directory_created_overall += total_directory_created
                    print(f"\ndirectory created by {target_filename}:")
                    for file_name in directory_created:
                        print(file_name)
                else:
                    print(f"\nNo directory created by {target_filename}")
    print(f"\nTotal number of directory created: {total_directory_created_overall}")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python script.py <directory_path>")
        sys.exit(1)
    
    directory_path = sys.argv[1]
    traverse_directory(directory_path)
