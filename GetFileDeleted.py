import os
import json
import sys

def extract_files_deleted(report_path):
    total_files_deleted = 0
    files_deleted = []
    try:
        with open(report_path, 'r') as report_file:
            report_data = json.load(report_file)
            target_filename = report_data["target"]["file"]["name"]
            behavior = report_data.get('behavior', {})
            summary = behavior.get('summary', {})
            files_deleted = summary.get('file_deleted', [])
            total_files_deleted = len(files_deleted)
    except Exception as e:
        print(f"Error processing {report_path}: {e}")
    return total_files_deleted, files_deleted, target_filename

def traverse_directory(directory_path):
    total_files_deleted_overall = 0
    for root, dirs, files in os.walk(directory_path):
        for file in files:
            if file == 'report.json':
                report_path = os.path.join(root, file)
                total_files_deleted, files_deleted, target_filename = extract_files_deleted(report_path)
                if files_deleted:
                    total_files_deleted_overall += total_files_deleted
                    print(f"\nFiles deleted by {target_filename} at {report_path}:")
                    for file_name in files_deleted:
                        print(file_name)
                else:
                    print(f"\nNo files deleted by {target_filename} at {report_path}")
    print(f"\nTotal number of files deleted: {total_files_deleted_overall}")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python script.py <directory_path>")
        sys.exit(1)
    
    directory_path = sys.argv[1]
    traverse_directory(directory_path)
